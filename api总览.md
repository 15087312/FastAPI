ğŸ¯ åº“å­˜å¾®æœåŠ¡ API è®¾è®¡ï¼ˆä¼ä¸šçº§æ ‡å‡†ç‰ˆï¼‰

## ğŸ“Š æ ¸å¿ƒåº“å­˜æŸ¥è¯¢æ¥å£

### 1ï¸âƒ£ å•ä¸ªå•†å“åº“å­˜æŸ¥è¯¢
```
GET /inventory/stock/{product_id}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "product_id": 1,
  "available_stock": 100
}
```

### 2ï¸âƒ£ æ‰¹é‡å•†å“åº“å­˜æŸ¥è¯¢
```
POST /inventory/stock/batch
```

**è¯·æ±‚å‚æ•°ï¼ˆBodyï¼‰ï¼š**
```json
{
  "product_ids": [1, 2, 3]
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "data": {
    "1": 100,
    "2": 50,
    "3": 0
  }
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "data": {
    "1": 100,
    "2": 50,
    "3": 0
  }
}
```

## ğŸ›¡ï¸ åº“å­˜æ“ä½œæ ¸å¿ƒæ¥å£

### 3ï¸âƒ£ é¢„å åº“å­˜ï¼ˆé˜²è¶…å–æ ¸å¿ƒï¼‰
```
POST /inventory/reserve?product_id=1&quantity=2&order_id=ORD123
```

**è¯·æ±‚å‚æ•°ï¼ˆQuery Parametersï¼‰ï¼š**
- `product_id` (int, required): å•†å“ID
- `quantity` (int, required): é¢„å æ•°é‡
- `order_id` (string, required): è®¢å•ID

**æ ¸å¿ƒé€»è¾‘ï¼š**
- ğŸ”’ æ•°æ®åº“è¡Œçº§é” (`.with_for_update()`)
- âœ… æ ¡éªŒ `available_stock >= quantity`
- â– æ‰£å‡ `available_stock`
- â• å¢åŠ  `reserved_stock`
- ğŸ“ åˆ›å»ºé¢„å è®°å½•ï¼ˆ15åˆ†é’Ÿè¿‡æœŸï¼‰
- ğŸ“Š è®°å½•åº“å­˜å˜æ›´æ—¥å¿—

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "é¢„å æˆåŠŸ",
  "data": true
}
```

### 4ï¸âƒ£ ç¡®è®¤åº“å­˜æ‰£å‡ï¼ˆæ”¯ä»˜æˆåŠŸï¼‰
```
POST /inventory/confirm/{order_id}
```

**è·¯å¾„å‚æ•°ï¼š**
- `order_id` (string, required): è®¢å•ID

**æ ¸å¿ƒé€»è¾‘ï¼š**
- ğŸ”’ è¡Œçº§é”æŸ¥è¯¢å•†å“åº“å­˜
- â– æ‰£å‡ `reserved_stock`
- ğŸ“ˆ å¢åŠ  `sales_count`ï¼ˆé”€é‡ç»Ÿè®¡ï¼‰
- ğŸ”„ æ›´æ–°é¢„å çŠ¶æ€ä¸º CONFIRMED
- ğŸ“Š è®°å½•ç¡®è®¤æ“ä½œæ—¥å¿—

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "ç¡®è®¤æˆåŠŸ",
  "data": true
}
```

### 5ï¸âƒ£ é‡Šæ”¾é¢„å åº“å­˜ï¼ˆå–æ¶ˆè®¢å•ï¼‰
```
POST /inventory/release/{order_id}
```

**è·¯å¾„å‚æ•°ï¼š**
- `order_id` (string, required): è®¢å•ID

**æ ¸å¿ƒé€»è¾‘ï¼š**
- ğŸ”’ è¡Œçº§é”æŸ¥è¯¢å•†å“åº“å­˜
- â• æ¢å¤ `available_stock`
- â– æ‰£å‡ `reserved_stock`
- ğŸ”„ æ›´æ–°é¢„å çŠ¶æ€ä¸º RELEASED
- ğŸ“Š è®°å½•é‡Šæ”¾æ“ä½œæ—¥å¿—

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "é‡Šæ”¾æˆåŠŸ",
  "data": true
}
```

## ğŸ§¹ è‡ªåŠ¨åŒ–ç»´æŠ¤æ¥å£

### 6ï¸âƒ£ æ‰‹åŠ¨è§¦å‘æ¸…ç†ä»»åŠ¡
```
POST /inventory/cleanup/manual?batch_size=500
```

**æŸ¥è¯¢å‚æ•°ï¼š**
- `batch_size` (int, optional): æ‰¹å¤„ç†å¤§å°ï¼Œé»˜è®¤500

**åŠŸèƒ½è¯´æ˜ï¼š**
- ğŸ¯ ç›´æ¥è°ƒç”¨ Service å±‚æ¸…ç†é€»è¾‘
- ğŸ“¦ æ‰¹å¤„ç†æ¨¡å¼ï¼ˆé»˜è®¤500æ¡/æ‰¹ï¼‰
- ğŸ”’ å¹¶å‘å®‰å…¨ï¼ˆskip_locked é˜²æ­¢ç«äº‰ï¼‰
- ğŸ“Š è¿”å›æ¸…ç†ç»Ÿè®¡ä¿¡æ¯

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "æ‰‹åŠ¨æ¸…ç†å®Œæˆ",
  "cleaned_count": 150
}
```

### 7ï¸âƒ£ å¼‚æ­¥æ¸…ç†ä»»åŠ¡è§¦å‘
```
POST /inventory/cleanup/celery?batch_size=500
```

**æŸ¥è¯¢å‚æ•°ï¼š**
- `batch_size` (int, optional): æ‰¹å¤„ç†å¤§å°ï¼Œé»˜è®¤500

**åŠŸèƒ½è¯´æ˜ï¼š**
- ğŸš€ é€šè¿‡ Celery å¼‚æ­¥æ‰§è¡Œ
- ğŸ“‹ è¿”å›ä»»åŠ¡ ID ç”¨äºçŠ¶æ€æŸ¥è¯¢
- â° é€‚åˆå®šæ—¶è°ƒåº¦å’Œå¤§æ‰¹é‡æ¸…ç†

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "å·²æäº¤å¼‚æ­¥æ¸…ç†ä»»åŠ¡",
  "task_id": "abcdef123456"
}
```

### 8ï¸âƒ£ æ¸…ç†ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢
```
GET /inventory/cleanup/status/{task_id}
```

**è·¯å¾„å‚æ•°ï¼š**
- `task_id` (string, required): ä»»åŠ¡ID

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "task_id": "abcdef123456",
  "status": "ä»»åŠ¡å®Œæˆ: æˆåŠŸæ¸…ç† 150 æ¡è¿‡æœŸé¢„å è®°å½•",
  "state": "SUCCESS"
}
```

## ğŸ—ï¸ ä¼ä¸šçº§æ¶æ„ç‰¹è‰²

### ğŸ¯ ä¸‰å±‚è°ƒç”¨å…¥å£
1. **API ç›´æ¥è°ƒç”¨** â†’ `/inventory/cleanup/manual`
2. **Celery å¼‚æ­¥è°ƒç”¨** â†’ `/inventory/cleanup/celery`
3. **æœ¬åœ° CLI è°ƒç”¨** â†’ `python -m app.jobs.manual_cleanup`

### ğŸ”§ æ ¸å¿ƒæŠ€æœ¯æ ˆ
- **Webæ¡†æ¶**: FastAPI + Uvicorn
- **æ•°æ®åº“**: PostgreSQL + SQLAlchemy ORM
- **ç¼“å­˜**: Redis (åº“å­˜ç¼“å­˜)
- **åˆ†å¸ƒå¼é”**: Redis Redlock
- **å¼‚æ­¥ä»»åŠ¡**: Celery + Redis Broker
- **æ•°æ®åº“è¿ç§»**: Alembic

### ğŸ”§ æ ¸å¿ƒæŠ€æœ¯ä¿éšœ
- **å¹¶å‘æ§åˆ¶**ï¼šæ•°æ®åº“è¡Œçº§é” + skip_locked
- **å†…å­˜ä¼˜åŒ–**ï¼šæ‰¹å¤„ç†é™åˆ¶ + å¾ªç¯æ¸…ç†
- **é”™è¯¯å¤„ç†**ï¼šäº‹åŠ¡å›æ»š + å¼‚å¸¸æ•è·
- **æ—¥å¿—è¿½è¸ª**ï¼šè¯¦ç»†æ‰§è¡Œè¿‡ç¨‹è®°å½•
- **æ‰©å±•æ€§**ï¼šæ”¯æŒå¤š Worker å¹¶è¡Œå¤„ç†

### ğŸ“Š æ€§èƒ½æŒ‡æ ‡
- **æ‰¹å¤„ç†å¤§å°**ï¼šå¯é…ç½®ï¼ˆæ¨è 500-1000ï¼‰
- **å¹¶å‘å®‰å…¨**ï¼šæ”¯æŒå¤šå®ä¾‹åŒæ—¶è¿è¡Œ
- **å†…å­˜å ç”¨**ï¼šO(batch_size) çº§åˆ«
- **æ‰§è¡Œæ•ˆç‡**ï¼šæ¯æ‰¹æ¬¡ 100-500ms

### ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§
- **è¾“å…¥éªŒè¯**ï¼šPydantic Schema æ ¡éªŒ
- **æƒé™æ§åˆ¶**ï¼šåŸºäºæœåŠ¡é—´è°ƒç”¨
- **é˜²é‡æ”¾æ”»å‡»**ï¼šå¹‚ç­‰æ€§è®¾è®¡
- **æ•°æ®ä¸€è‡´æ€§**ï¼šACID äº‹åŠ¡ä¿è¯